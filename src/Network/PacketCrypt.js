/**
 * NetWork/PacketCrypt.js
 *
 * Encrypt packets with defined keys
 * It's an official features used in the Hercules emulator. As some servers may used it it has
 * to be implement in roBrowser.
 *
 * Source: http://hercules.ws/board/topic/1105-hercules-wpe-free-june-14th-patch/
 *
 * To enable it, you have to set the parameter "packetKeys" in the ROConfig array :
 * - If set to true, the client will use the packetver used by roBrowser to find its keys (check the KeysTable list behind)
 * - If set to a date (ex: 20120111), roBrowser will use the keys related to this version.
 * - If set to an array (ex: [0x053D5CED,0x3DED6DED,0x6DED6DED]), roBrowser will use the keys specified.
 *
 * This file is part of ROBrowser, (http://www.robrowser.com/).
 *
 * @author Vincent Thibault
 */

define(['Core/Configs'], function( Configs )
{
	'use strict';


	/**
	 * @var {integer} Keys to shuffle the packet
	 */
	var _keys      = new Uint32Array(3);


	/**
	 * @var {boolean} is encryption available ?
	 */
	var _available = false;


	/**
	 * @var {List} date => encryption keys
	 */
	var KeysTable = {
		20101123: [0x49357D72,0x22C370A1,0x5F836591],
		20101124: [0x49357D72,0x22C370A1,0x5F836591],
		20101126: [0x49357D72,0x22C370A1,0x5F836591],
		20101130: [0x3726593C,0x0EFD5EE8,0x79036DF9],
		20101207: [0x66111112,0x2B7B53AA,0x04E76DF8],
		20101214: [0x5E535D06,0x4E297F0E,0x400B6AD8],
		20101221: [0x0448466A,0x41554AC9,0x5B4710B2],
		20101228: [0x50C638A5,0x4BF86B20,0x480C3746],
		20110104: [0x55DB401F,0x047D4E02,0x6D8F2EA3],
		20110111: [0x2D5F6302,0x2A361CD6,0x39D661D6],
		20110118: [0x3C777D2D,0x00541A1D,0x5E0053A2],
		20110125: [0x6BB84BB0,0x4C004382,0x10AE3260],
		20110126: [0x6BB84BB0,0x4C004382,0x10AE3260],
		20110131: [0x68871E62,0x60D17266,0x74726DAA],
		20110201: [0x68871E62,0x60D17266,0x74726DAA],
		20110208: [0x72BA4E9D,0x281E1DF1,0x208255AA],
		20110210: [0x72BA4E9D,0x281E1DF1,0x208255AA],
		20110215: [0x1B174D76,0x32005014,0x7B8B72D5],
		20110222: [0x48F73B56,0x155F7D66,0x44AB57CE],
		20110223: [0x48F73B56,0x155F7D66,0x44AB57CE],
		20110224: [0x48F73B56,0x155F7D66,0x44AB57CE],
		20110225: [0x48F73B56,0x155F7D66,0x44AB57CE],
		20110228: [0x26385EBF,0x7A8C7534,0x60AE2C34],
		20110308: [0x003F1B20,0x7A1E12A3,0x34994AAD],
		20110309: [0x003F1B20,0x7A1E12A3,0x34994AAD],
		20110315: [0x62967D7D,0x34833D1A,0x26D45ECA],
		20110316: [0x62967D7D,0x34833D1A,0x26D45ECA],
		20110322: [0x5870617C,0x638D5376,0x739F4817],
		20110329: [0x06900BB7,0x45DB687B,0x197B017B],
		20110330: [0x06900BB7,0x45DB687B,0x197B017B],
		20110405: [0x248D5C37,0x1C6A1B37,0x1F644FDB],
		20110412: [0x3DE86BFC,0x0DD47F80,0x42481C9B],
		20110419: [0x26073204,0x62013A51,0x22AC58E0],
		20110426: [0x392813F9,0x09905054,0x40DB732E],
		20110503: [0x28BE32EE,0x1D506FCB,0x63832421],
		20110511: [0x6A715733,0x3C5C0D74,0x408A48EC],
		20110517: [0x07FE0C72,0x46766BAD,0x5EB5126A],
		20110523: [0x69166916,0x69166916,0x69166916],
		20110526: [0x69166916,0x69166916,0x69166916],
		20110531: [0x5ABA2C7C,0x3CD22073,0x78953988],
		20110607: [0x76B0426C,0x0DD74DEB,0x1F92228E],
		20110608: [0x76B0426C,0x0DD74DEB,0x1F92228E],
		20110609: [0x76B0426C,0x0DD74DEB,0x1F92228E],
		20110614: [0x5749027B,0x71710972,0x5B096475],
		20110620: [0x3A1760D4,0x254E0DF9,0x440E2357],
		20110627: [0x3EFC29BD,0x699E4B11,0x7B900A13],
		20110705: [0x48801A5E,0x68FC7726,0x081D7F6E],
		20110711: [0x489C544B,0x33BA1C25,0x2DE66E4E],
		20110713: [0x489C544B,0x33BA1C25,0x2DE66E4E],
		20110718: [0x08464674,0x1EEB3BD5,0x33395199],
		20110726: [0x41E5730B,0x119C6C11,0x5356524A],
		20110802: [0x607C08A1,0x65B20528,0x360571E9],
		20110809: [0x742A559A,0x047F425D,0x5C8C2CA0],
		20110816: [0x053D5CED,0x3DED6DED,0x6DED6DED],
		20110817: [0x053D5CED,0x3DED6DED,0x6DED6DED],
		20110823: [0x35C91401,0x262A5556,0x28FA03AA],
		20110824: [0x35C91401,0x262A5556,0x28FA03AA],
		20110831: [0x3AD67ED0,0x44703C69,0x6F876809],
		20110906: [0x350124EC,0x39A14595,0x0DE56125],
		20110914: [0x350124EC,0x39A14595,0x0DE56125],
		20110920: [0x79C91A12,0x20450CC0,0x584B2A38],
		20110928: [0x26567512,0x4B0732DF,0x57D266C6],
		20110929: [0x26567512,0x4B0732DF,0x57D266C6],
		20111004: [0x291E6762,0x77CD391A,0x60AC2F16],
		20111005: [0x291E6762,0x77CD391A,0x60AC2F16],
		20111010: [0x7F3C2D29,0x59B01DE6,0x1DBB44CA],
		20111012: [0x7F3C2D29,0x59B01DE6,0x1DBB44CA],
		20111017: [0x357D55DC,0x5A8D759F,0x245C30F5],
		20111019: [0x357D55DC,0x5A8D759F,0x245C30F5],
		20111021: [0x357D55DC,0x5A8D759F,0x245C30F5],
		20111025: [0x50AE1A63,0x3CE579B5,0x29C10406],
		20111101: [0x5324329D,0x5D545D52,0x06137269],
		20111102: [0x5324329D,0x5D545D52,0x06137269],
		20111108: [0x0B642BDA,0x6ECB1D1C,0x61C7454B],
		20111109: [0x0B642BDA,0x6ECB1D1C,0x61C7454B],
		20111114: [0x419D0DB0,0x74916BF4,0x027371B4],
		20111116: [0x419D0DB0,0x74916BF4,0x027371B4],
		20111122: [0x3B550F07,0x1F666C7C,0x60304EF5],
		20111123: [0x3B550F07,0x1F666C7C,0x60304EF5],
		20111207: [0x2A610886,0x3E09165E,0x57C11888],
		20111213: [0x5151306B,0x7AE32886,0x53060628],
		20111214: [0x5151306B,0x7AE32886,0x53060628],
		20111220: [0x05D53871,0x7D0027B4,0x29975333],
		20111227: [0x0FF87E93,0x6CFF7860,0x3A3D1DEC],
		20111228: [0x0FF87E93,0x6CFF7860,0x3A3D1DEC],
		20120103: [0x262034A1,0x674542A5,0x73A50BA5],
		20120104: [0x262034A1,0x674542A5,0x73A50BA5],
		20120110: [0x2B412AFC,0x4FF94487,0x6705339D],
		20120111: [0x2B412AFC,0x4FF94487,0x6705339D],
		20120117: [0x24E32C2E,0x48DD17A5,0x64F8771A],
		20120118: [0x24E32C2E,0x48DD17A5,0x64F8771A],
		20120120: [0x504345D0,0x3D427B1B,0x794C2DCC],
		20120131: [0x2CFC0A71,0x2BA91D8D,0x087E39E0],
		20120201: [0x2CFC0A71,0x2BA91D8D,0x087E39E0],
		20120202: [0x2CFC0A71,0x2BA91D8D,0x087E39E0],
		20120207: [0x1D373F5D,0x5ACD604D,0x1C4D7C4D],
		20120208: [0x1D373F5D,0x5ACD604D,0x1C4D7C4D],
		20120209: [0x1D373F5D,0x5ACD604D,0x1C4D7C4D],
		20120214: [0x7A255EFA,0x30977276,0x2D4A0448],
		20120215: [0x7A255EFA,0x30977276,0x2D4A0448],
		20120221: [0x1CA5130F,0x43ED240A,0x7FEA3BE0],
		20120222: [0x1CA5130F,0x43ED240A,0x7FEA3BE0],
		20120228: [0x520B4C64,0x2800407D,0x47651458],
		20120229: [0x520B4C64,0x2800407D,0x47651458],
		20120307: [0x382A6DEF,0x5CBE7202,0x61F46637],
		20120314: [0x689C1729,0x11812639,0x60F82967],
		20120320: [0x21F9683F,0x710C5CA5,0x1FD910E9],
		20120321: [0x21F9683F,0x710C5CA5,0x1FD910E9],
		20120328: [0x75B8553B,0x37F20B12,0x385C2B40],
		20120404: [0x0036310C,0x2DCD0BED,0x1EE62A78],
		20120410: [0x01581359,0x452D6FFA,0x6AFB6E2E],
		20120417: [0x01540E48,0x13041224,0x31247924],
		20120418: [0x01540E48,0x13041224,0x31247924],
		20120424: [0x411D1DBB,0x4CBA4848,0x1A432FC4],
		20120502: [0x37A91D19,0x10190019,0x00190019],
		20120503: [0x37A91D19,0x10190019,0x00190019],
		20120508: [0x16CF3301,0x1F472B9B,0x0B4A3CD2],
		20120509: [0x16CF3301,0x1F472B9B,0x0B4A3CD2],
		20120515: [0x4A715EF9,0x79103E4F,0x405C1238],
		20120522: [0x70EB4CCB,0x0487713C,0x398D4B08],
		20120523: [0x70EB4CCB,0x0487713C,0x398D4B08],
		20120525: [0x70EB4CCB,0x0487713C,0x398D4B08],
		20120529: [0x53415DDE,0x34953E16,0x27623DF2],
		20120601: [0x68CA3080,0x31B74BDD,0x505208F1],
		20120604: [0x68CA3080,0x31B74BDD,0x505208F1],
		20120605: [0x68CA3080,0x31B74BDD,0x505208F1],
		20120612: [0x32E45D64,0x35643564,0x35643564],
		20120618: [0x261F261F,0x261F261F,0x261F261F],
		20120626: [0x02277E66,0x045723F1,0x7107392C],
		20120627: [0x02277E66,0x045723F1,0x7107392C],
		20120702: [0x25733B31,0x53486CFD,0x398649BD],
		20120710: [0x0E8B7AFB,0x6930362D,0x42D33A57],
		20120712: [0x0E8B7AFB,0x6930362D,0x42D33A57],
		20120716: [0x76052205,0x22052205,0x22052205],
		20120724: [0x783D5BC6,0x3AAC2176,0x66616F02],
		20120801: [0x71FB6768,0x5843166B,0x6CB445C6],
		20120808: [0x5D5068BB,0x36732065,0x47CF7367],
		20120814: [0x203E21BD,0x047459FB,0x56AF5A97],
		20120822: [0x06A92E7B,0x3D324F29,0x5FD63004],
		20120830: [0x0AF1363D,0x4AB33E3B,0x48421DBE],
		20120905: [0x04F50D80,0x092F5C4D,0x29BF3DCF],
		20120911: [0x1F3D1145,0x02DB3C32,0x4BE34C49],
		20120919: [0x72E00F24,0x4EA02D80,0x7C803480],
		20120925: [0x43A66E22,0x36C2229F,0x08172ECE],
		20120926: [0x43A66E22,0x36C2229F,0x08172ECE],
		20121010: [0x169733E2,0x4C4640DC,0x31636531],
		20121011: [0x169733E2,0x4C4640DC,0x31636531],
		20121017: [0x340C0C31,0x33205EA8,0x55964BFF],
		20121024: [0x6166335C,0x45393483,0x7EDC5478],
		20121031: [0x66EB7ADB,0x242864BB,0x354A4CDE],
		20121107: [0x49967892,0x48025276,0x1E192CA3],
		20121114: [0x3473545C,0x2706445C,0x79647616],
		20121121: [0x6EB54B0B,0x3F2A6BE5,0x0B2866E6],
		20121128: [0x146D4D5E,0x5C3D161B,0x759250B8],
		20121205: [0x218C64B6,0x4EFE17AE,0x27EA5E74],
		20121212: [0x7F8026F0,0x32EE2A4B,0x73746C0E],
		20121218: [0x6A5450A2,0x4322498A,0x2C6574FB],
		20121227: [0x71773018,0x36A14EEB,0x28CD5A20],
		20130103: [0x1E1A559A,0x199A799A,0x799A799A],
		20130107: [0x1E1A559A,0x199A799A,0x799A799A],
		20130109: [0x6435360F,0x0A283678,0x64A04AC7],
		20130115: [0x273C25CD,0x06AA48AF,0x45A01BD4],
		20130116: [0x273C25CD,0x06AA48AF,0x45A01BD4],
		20130121: [0x5DD874B0,0x7D98233F,0x28FF5566],
		20130130: [0x1EA57961,0x27786856,0x30301FA0],
		20130206: [0x1D8F4227,0x675812AA,0x29132929],
		20130215: [0x69FB1C38,0x7D386860,0x62805311],
		20130220: [0x0D555256,0x28C26722,0x72220A22],
		20130227: [0x44F86842,0x43786A7A,0x71654528],
		20130306: [0x7E274326,0x7D182DF2,0x4FC27DFA],
		20130313: [0x560021C3,0x6A5D110F,0x52BD40A5],
		20130320: [0x3F094C49,0x55F86C1E,0x58AA359A],
		20130327: [0x114B1BA0,0x2C4F0AE2,0x5FA1183F],
		20130403: [0x424A43AE,0x4A9D5EBE,0x4B3518A9],
		20130410: [0x3AD52ACA,0x314D1AED,0x086E415E],
		20130417: [0x7FB13B83,0x6E003749,0x07A02B94],
		20130424: [0x79F679F6,0x79F679F6,0x79F679F6],
		20130502: [0x62E733B9,0x62204281,0x7F044DCA],
		20130508: [0x25421E49,0x175200BA,0x6C0B5239],
		20130514: [0x75794A38,0x58A96BC1,0x296E6FB8],
		20130515: [0x75794A38,0x58A96BC1,0x296E6FB8],
		20130522: [0x6948050B,0x06511D9D,0x725D4DF1],
		20130529: [0x023A6C87,0x14BF1F1E,0x5CC70CC9],
		20130605: [0x646E08D9,0x5F153AB5,0x61B509B5],
		20130612: [0x6D166F66,0x3C000FCF,0x295B0FCB],
		20130618: [0x434115DE,0x34A10FE9,0x6791428E],
		20130626: [0x38F453EF,0x6A040FD8,0x65BD6668],
		20130703: [0x4FF90E23,0x0F1432F2,0x4CFA1EDA],
		20130710: [0x4A9C4237,0x4CCF3F8F,0x458F758F],
		20130717: [0x5EE5520C,0x5F9E00CF,0x2BED4F91],
		20130724: [0x3C243BF5,0x42CC4E2F,0x02106EC6],
		20130731: [0x1E9D11A6,0x21A232B8,0x6A9E02B7],
		20130807: [0x7E241DE0,0x5E805580,0x3D807D80],
		20130814: [0x23A23148,0x0C41420E,0x53785AD7],
		20130821: [0x51673F38,0x01663512,0x5CFF0B3D],
		20130828: [0x02EF7A9A,0x4882042F,0x76796678],
		20130904: [0x41AF20C5,0x0997799E,0x4AE803A0],
		20130911: [0x232B3F47,0x0AD0515F,0x1CA31828],
		20130917: [0x5C9164C5,0x32B62F83,0x52864548],
		20130925: [0x4B9C279A,0x0C7849C4,0x72A77646],
		20131002: [0x63A466F7,0x635362F3,0x41F369F3],
		20131008: [0x64924AAD,0x08CA0445,0x1CBC36DE],
		20131016: [0x33AD7A93,0x720C7C49,0x12C4205A],
		20131023: [0x02EF6163,0x2B774814,0x58EC3036],
		20131030: [0x4A6A3EFF,0x7E2D5237,0x01CA019E],
		20131106: [0x143E528F,0x5CA05899,0x44B85B23],
		20131107: [0x143E528F,0x5CA05899,0x44B85B23],
		20131108: [0x143E528F,0x5CA05899,0x44B85B23],
		20131113: [0x44EA14CD,0x49311C88,0x40C86C31],
		20131120: [0x541E5172,0x1B1D30A0,0x28AA7CE5],
		20131127: [0x21426A48,0x5C505D6A,0x046D06AD],
		20131204: [0x792760B2,0x5AF45387,0x36165603],
		20131211: [0x55B0394E,0x4D341FF2,0x60BC1DC3],
		20131218: [0x6A596301,0x76866D0E,0x32294A45],
		20131223: [0x631C511C,0x111C111C,0x111C111C],
		20131230: [0x611B7097,0x01F957A1,0x768A0FCB],
		20140108: [0x4A1E26F2,0x231E7EFE,0x61FE19FE],
		20140115: [0x63224335,0x0F3A1F27,0x6D217B24],
		20140122: [0x6123177B,0x05B42C99,0x71702594],
		20140129: [0x2E52163C,0x605E518B,0x3C7A62CB],
		20140205: [0x63DC7BDC,0x7BDC7BDC,0x7BDC7BDC],
		20140212: [0x46837074,0x65292E89,0x77237F9C],
		20140219: [0x4E3C5327,0x3A6B5469,0x2CE36AED],
		20140226: [0x36D71056,0x52122F5E,0x6FF76E99],
		20140305: [0x116763F2,0x41117DAC,0x7FD13C45],
		20140312: [0x48911E4E,0x58CB2EB3,0x05232619],
		20140319: [0x3DA44383,0x1ABB165F,0x5B6846B9],
		20140326: [0x68E72AF6,0x27DB4C3D,0x348F2677],
		20140402: [0x15D3271C,0x004D725B,0x111A3A37],
		20140409: [0x7F6C390F,0x139C254C,0x7F25708C],
		20140416: [0x04810281,0x42814281,0x42814281],
		20140423: [0x7E0D6B56,0x74673CD3,0x2EBA4940],
		20140430: [0x400145D8,0x3FE50155,0x11624F70],
		20140508: [0x087E57EC,0x25224F4A,0x024F12C6],
		20140514: [0x4BE46730,0x047926E0,0x37773BBB],
		20140521: [0x14ED2D86,0x17371C33,0x2D0473C8],
		20140528: [0x579445EB,0x26734878,0x7C861628],
		20140605: [0x5ABC4223,0x04DD2636,0x0D5850E0],
		20140611: [0x4FC83479,0x3AB04D1F,0x477B4010],
		20140612: [0x4FC83479,0x3AB04D1F,0x477B4010],
		20140613: [0x4FC83479,0x3AB04D1F,0x477B4010],
		20140618: [0x2DB507BB,0x11BA12E7,0x7F447760],
		20140625: [0x09987045,0x644B1051,0x1A091CB8],
		20140702: [0x5C4574F4,0x5D446386,0x48BD24C9],
		20140709: [0x2C7A6E92,0x324F1B85,0x29916FC2],
		20140716: [0x0EB20408,0x6D6C4292,0x4F6E4CF3],
		20140723: [0x42A21713,0x51CE6EAD,0x102F7B0B],
		20140730: [0x63CE4E53,0x04F969A3,0x690954DB],
		20140806: [0x0D5B69AC,0x3C001F20,0x0C201420],
		20140813: [0x7AD51E0A,0x28C72C46,0x210205BD],
		20140814: [0x7AD51E0A,0x28C72C46,0x210205BD],
		20140820: [0x374F15D0,0x64C87DEC,0x65CE2A41],
		20140827: [0x53814CA2,0x27DE193E,0x503E683E],
		20140903: [0x2F386F34,0x0F935365,0x76A43888],
		20140917: [0x180118EA,0x440134CF,0x3A99179D],
		20140924: [0x6F5222D8,0x593B798C,0x4CBD655E],
		20141001: [0x6D882C11,0x7DF959E2,0x4F3F60E8],
		20141008: [0x754365B3,0x36B326B3,0x26B326B3],
		20141015: [0x2DFF467C,0x444B37EE,0x2C1B634F],
		20141016: [0x2DFF467C,0x444B37EE,0x2C1B634F],
		20141022: [0x290551EA,0x2B952C75,0x2D67669B],
		20141029: [0x1AFD581D,0x2E1D4E1D,0x4E1D4E1D],
		20141105: [0x7F310819,0x5FF45401,0x2D303DD9],
		20141112: [0x430C0C27,0x067153CF,0x5E5439A9],
		20141119: [0x7A7E7EDE,0x24EB02E3,0x71603607],
		20141126: [0x01E14C42,0x56D73044,0x4B3278DF],
		20141203: [0x66CB52E4,0x1EB84093,0x33563E18],
		20141210: [0x0B0B1DD3,0x26EF1797,0x4F40370B],
		20141217: [0x01AB478C,0x0FDE58F2,0x1DAC7303],
		20141223: [0x2E8936E6,0x34463C46,0x67CD3885],
		20141224: [0x2E8936E6,0x34463C46,0x67CD3885],
		20141231: [0x154C347E,0x54B26512,0x52126A12],
		20150107: [0x6C494A14,0x4DDB6427,0x3E6D7B65],
		20150114: [0x21C96102,0x13142934,0x1ABF4EA3],
		20150121: [0x0B9D2AF5,0x658A3346,0x379E3654],
		20150128: [0x77CA2D55,0x28B608F0,0x75B47957],
		20150129: [0x77CA2D55,0x28B608F0,0x75B47957],
		20150130: [0x77CA2D55,0x28B608F0,0x75B47957],
		20150204: [0x134529DB,0x5B4F6CEF,0x29EF11EF],
		20150211: [0x33911A25,0x1E6945FD,0x7385623A],
		20150217: [0x731B731B,0x731B731B,0x731B731B],
		20150225: [0x57FD4B7B,0x19CC16FB,0x0D255D72],
		20150226: [0x57FD4B7B,0x19CC16FB,0x0D255D72],
		20150304: [0x1A657B1C,0x7E1806E7,0x55396A5C],
		20150311: [0x48C45D97,0x06CE09B0,0x5836642F],
		20150318: [0x1B3738E7,0x0AD4238F,0x7D252A1F],
		20150325: [0x68F62B8C,0x337C3468,0x38FC0AC7],
		20150401: [0x207F3A08,0x57E6160C,0x02A60382],
		20150408: [0x39812C9D,0x23DA516E,0x59A33DD2],
		20150415: [0x7EC44F6A,0x7DE57139,0x60DA5436],
		20150422: [0x10D22CE2,0x69E279E2,0x79E279E2],
		20150429: [0x2BF61A71,0x565D5DDF,0x0FB90019],
		20150507: [0x55B54373,0x58967821,0x67F41832],
		20150513: [0x62C86D09,0x75944F17,0x112C133D],
		20150520: [0x17430238,0x44DE585F,0x56A40616],
		20150527: [0x35AE7BAE,0x3BAE3BAE,0x3BAE3BAE],
		20150603: [0x1DDD245D,0x309446E0,0x58E53F1F],
		20150610: [0x2FC406D3,0x7B3E32F5,0x02B80B47],
		20150617: [0x250F7E09,0x25416076,0x029A780E],
		20150618: [0x250F7E09,0x25416076,0x029A780E],
		20150624: [0x440B0E24,0x1BEA7A4C,0x2C646784],
		20150701: [0x4DD55F9B,0x70C67B03,0x78C60DB6],
		20150702: [0x4DD55F9B,0x70C67B03,0x78C60DB6],
		20150708: [0x451C5E19,0x5661750B,0x2F4644AC],
		20150715: [0x1F805483,0x67745585,0x7FCE189C],
		20150722: [0x41FA53D4,0x2CF044E2,0x663A3F1D],
		20150729: [0x08EE40A9,0x206F3D7F,0x0AE37339],
		20150805: [0x1C3F243F,0x243F243F,0x243F243F],
		20150812: [0x0B6F64A8,0x5BCC47EC,0x00EC08EC],
		20150819: [0x1A2400E0,0x736E5686,0x10F315D5],
		20150826: [0x77883C56,0x1829359F,0x0DE635B6],
		20150902: [0x4EDB18C1,0x6B9355BA,0x38AA6239],
		20150909: [0x19AB2BF0,0x04754299,0x48770736],
		20150916: [0x17F83A19,0x116944F4,0x1CC541E9],
		20150923: [0x765742B9,0x22D61C2F,0x7DA94FB2],
		20151001: [0x5CFF4561,0x32514AD1,0x06D126D1],
		20151007: [0x3C6447A8,0x032170D7,0x6490476C],
		20151014: [0x402728A8,0x5D0E309F,0x240018FD],
		20151021: [0x0311104D,0x46C326D6,0x00E82720],
		20151022: [0x0311104D,0x46C326D6,0x00E82720],
		20151028: [0x45B945B9,0x45B945B9,0x45B945B9],
		20151029: [0x45B945B9,0x45B945B9,0x45B945B9],
		20151104: [0x4C17382A,0x7ED174C9,0x29961E4F],
		20151111: [0x46097C77,0x5F193871,0x29140A21],
		20151118: [0x734C3241,0x6E846F34,0x731C06D6],
		20151125: [0x237446C0,0x5EFB343A,0x0EDF06C5],
		20151202: [0x4EDE52DE,0x52DE52DE,0x52DE52DE],
		20151209: [0x652C5898,0x7A351FB3,0x67EA2886],
		20151216: [0x25DD643D,0x61AC39DE,0x77A8206D],
		20151223: [0x347D68D0,0x2C705320,0x7B4A199D],
		20151230: [0x54C51241,0x33883499,0x3CDA35F0],
		20160106: [0x40520265,0x33FE26FC,0x7136294F],
		20160113: [0x18005C4B,0x19A94A72,0x73F678EC],
		20160120: [0x51495149,0x51495149,0x51495149],
		20160127: [0x6B1E7146,0x612C47E6,0x274E56EE],
		20160203: [0x3E1411AF,0x6C744497,0x7CFA1BDE],
		20160211: [0x613813EA,0x05251DAB,0x1FD35E33],
		20160217: [0x25895A8E,0x09421C19,0x763A2D7A],
		20160224: [0x7088019A,0x13471F02,0x42356A7D],
		20160302: [0x7B4441B9,0x5BBC63AF,0x45DA0E71],
		20160309: [0x21587520,0x353A7706,0x1B722B25],
		20160316: [0x62363E36,0x3E363E36,0x3E363E36],
		20160318: [0x62363E36,0x3E363E36,0x3E363E36],
		20160323: [0x73E35A83,0x62142FA8,0x12BA36BD],
		20160330: [0x02050940,0x545336FF,0x7E7D4902],
		20160406: [0x568611EA,0x32457D8D,0x2B020477],
		20160414: [0x31BD479A,0x40C61398,0x397C1A80],
		20160420: [0x67D2163A,0x3068215B,0x4835474D],
		20160427: [0x12DC378E,0x4E3E7EBE,0x0ABE2ABE],
		20160504: [0x09E0544C,0x0231251D,0x2F4E195F],
		20160511: [0x3C666FE2,0x27E84E3E,0x53E11BA5],
		20160518: [0x57DB7CA1,0x1FEA1629,0x26DD244D],
		20160525: [0x485C45B6,0x47DC6192,0x76B34A36],
		20160526: [0x485C45B6,0x47DC6192,0x76B34A36],
		20160601: [0x3DAD32C4,0x59F001BE,0x73F65E56],
		20160608: [0x11D74609,0x77C43E8A,0x44290F53],
		20160609: [0x11D74609,0x77C43E8A,0x44290F53],
		20160615: [0x062C5C26,0x6CF47E82,0x4DD53480],
		20160622: [0x426548AB,0x5C0F5DD4,0x03022710],
		20160629: [0x0DF31CCC,0x54281606,0x5C4C6855],
		20160630: [0x0DF31CCC,0x54281606,0x5C4C6855],
		20160706: [0x33A766D0,0x743F04F8,0x0FA0276C],
		20160713: [0x714F2495,0x7DDC6F32,0x3FD8533D],
		20160720: [0x4F8A19C0,0x2D8E085C,0x37BB67D6],
		20160727: [0x3C6952AB,0x26E4077F,0x37E25DF7],
		20160803: [0x67F438C2,0x512A4EB7,0x2D353182],
		20160810: [0x2F252886,0x242234A2,0x48BC5032],
		20160817: [0x675E6900,0x3F8E1D16,0x58D650E5],
		20160824: [0x2FA92FA9,0x2FA92FA9,0x2FA92FA9],
		20160831: [0x564E13B0,0x7F680549,0x382D273B],
		20160907: [0x32E5237D,0x57BD4DBD,0x5DBD5DBD],
		20160913: [0x7C79748F,0x1AA03B1D,0x6EAC4747],
		20160921: [0x11CD15CD,0x15CD15CD,0x15CD15CD],
		20160928: [0x2F8C67F5,0x22D42C38,0x57513774],
		20161005: [0x5BAE21F8,0x021E2FFC,0x3BEB7C31],
		20161012: [0x5E2311F2,0x14FD012C,0x76EB64F6],
		20161019: [0x34882F11,0x7C870E70,0x7E61350D],
		20161026: [0x2CB86AE6,0x7D12660E,0x1B004DEB],
		20161102: [0x76725C17,0x72FE4EC1,0x07A91BFD],
		20161103: [0x76725C17,0x72FE4EC1,0x07A91BFD],
		20161109: [0x0A5277C0,0x2DB17506,0x0E8F26DA],
		20161116: [0x780C5C3F,0x15E92272,0x2BA770C5],
		20161123: [0x66FF559F,0x00D3535B,0x236246F7],
		20161130: [0x2ED80296,0x0D837373,0x20266F9A],
		20161207: [0x52D267AA,0x4FE42156,0x1292153E],
		20161214: [0x4DDE217B,0x07863AE0,0x5B591656],
		20161221: [0x69CB4F56,0x793C165E,0x673A2354],
		20161228: [0x09366971,0x005672F1,0x6F3712AE],
		20170104: [0x44416BC3,0x6C8D1817,0x072D75D5],
		20170111: [0x19B637F9,0x0E9C378A,0x41673186],
		20170118: [0x456B36EB,0x15EB34B0,0x18C42E43],
		20170125: [0x066E04FE,0x3004224A,0x04FF0458],
		20170201: [0x2011228E,0x00453005,0x628E7F0A],
		20170208: [0x6A764E5F,0x0609570D,0x28AE07FA],
		20170215: [0x50C01315,0x51012A42,0x679E16C3],
		20170222: [0x5A242F2F,0x6C556187,0x73C022CB],
		20170228: [0x771D4F2B,0x20EF1F4C,0x0D5135C8],
		20170308: [0x653470A9,0x6B316A71,0x5C712C71],
		20170315: [0x399A0856,0x56642A94,0x7F77157D],
		20170322: [0x2050167B,0x01731233,0x40337033],
		20170329: [0x18B31A80,0x1B0B1D56,0x16857D6A],
		20170405: [0x1FDE7DAC,0x2F9F5B63,0x3F2062AF],
		20170412: [0x39223393,0x5C847779,0x10217985],
		20170419: [0x1F8F4B3F,0x2E481F03,0x39ED4178],
		20170426: [0x167642A7,0x1DEC3D26,0x6D046D4C],
		20170502: [0x05224194,0x466D4204,0x31F02EE0],
		20170517: [0x2CC4749A,0x1FA954DC,0x72276857],
		20170524: [0x0B4E03A6,0x2B93427C,0x583D4477],
		20170531: [0x03FA5A97,0x20B802D5,0x339F1977],
		20170607: [0x50564ACD,0x79CA4E15,0x405F4894],
		20170614: [0x5ED10A48,0x667F4301,0x2E5D761F],
		20170621: [0x155F34EC,0x2D943FA9,0x3D9170EB],
		20170628: [0x04691C86,0x43C210E2,0x2FE277E2],
		20170705: [0x7EB000AE,0x02FB1DBC,0x5CB131E6],
		20170712: [0x2C3C202C,0x3F2C2F2C,0x2F2C2F2C],
		20170719: [0x46465C88,0x10116F66,0x200866F9],
		20170726: [0x102F23DB,0x7E767751,0x3BC172EF],
		20170801: [0x26B52A7F,0x5377619D,0x4F580AC4],
		20170809: [0x452156CB,0x71442624,0x2EE66D1C],
		20170816: [0x78914673,0x3F8B7634,0x55B814BC],
		20170823: [0x22677205,0x393D1002,0x58DC6BB4],
		20170830: [0x1D49592B,0x00970C17,0x1E640103],
		20170906: [0x7DEF7677,0x351F36E6,0x52303485],
		20170913: [0x7A645935,0x1DA05062,0x5A7A4C43],
		20170920: [0x53024DA5,0x04EC212D,0x0BF87CD4],
		20170927: [0x15624100,0x0CE1463E,0x0E5D6534],
		20171002: [0x15E1716C,0x4E765B63,0x357D2370],
		20171011: [0x4F121B3E,0x12670E17,0x19896C11],
		20171018: [0x2CAA109C,0x158C1EC2,0x7A5E58F3],
		20171025: [0x165C565C,0x565C565C,0x565C565C],
		20171101: [0x7056317F,0x7EEE0589,0x02672373],
		20171108: [0x03695685,0x7FAC12CE,0x182F7A7B],
		20171115: [0x23B97A3B,0x34610993,0x2892070E],
		20171122: [0x03221B0E,0x73AB7A5F,0x0DD80FD4],
		20171129: [0x581B77A7,0x62F74D7A,0x4F102173],
		20171206: [0x39D54BD3,0x577A0C21,0x4C1C316E],
		20171213: [0x44E41107,0x3B126921,0x00E06AAC],
		20171220: [0x6EFE009A,0x440B7BFA,0x052339C8],
		20171227: [0x257A2F6E,0x51140EEE,0x00FA4452],
		20180103: [0x348F4BD7,0x7A425A54,0x628F589A],
		20180117: [0x21F477F4,0x37F437F4,0x37F437F4],
		20180124: [0x7EAA1CE0,0x415D1CFD,0x4C8F19FA],
		20180131: [0x7EAA1CE0,0x415D1CFD,0x4C8F19FA],
		20180207: [0x45AA1B44,0x20E716B7,0x5388105C],
		20180213: [0x189D69B2,0x43B85EAD,0x2B7A687E],
		20180221: [0x6E2F6233,0x193B0A66,0x0D1D2CA5],
		20180307: [0x47DA10EB,0x4B922CCF,0x765C5055],
		20180309: [0x47DA10EB,0x4B922CCF,0x765C5055],
		20180314: [0x2FF07149,0x00596EA3,0x2B853026]
	};


	/**
	 * Multiply two integers - because javascript precision sux
	 *
	 * @param {number} a
	 * @param {number} b
	 *
	 * @returns a * b
	 */
	var imul;

	// Check for support and kick out Safari bug
	if (Math.imul && Math.imul(0xffffffff, 5) === -5) {
		imul = Math.imul;
	}
	else {
		imul = function imul(a, b) {
			var ah = (a >>> 16) & 0xffff;
			var al = a & 0xffff;
			var bh = (b >>> 16) & 0xffff;
			var bl = b & 0xffff;
			// the shift by 0 fixes the sign on the high part
			// the final |0 converts the unsigned value into a signed value
			return ((al * bl) + (((ah * bl + al * bh) << 16) >>> 0)|0);
		};
	}


	/**
	 * Initialize to get keys for packet encryption
	 */
	function Init()
	{
		var packetKeys;

		_available = false;
		packetKeys = Configs.get('packetKeys');

		if (!packetKeys) {
			return;
		}

		// Custom keys
		if (packetKeys instanceof Array) {
			_available = true;
			_keys.set(packetKeys);
		}

		else {
			var date, key;

			// Define a date or use the defined packetver ?
			if (typeof packetKeys === 'number') {
				date = packetKeys;
			}
			else {
				date = Configs.get('packetver');
			}

			// Get the available keys
			for (key in KeysTable) {
				if (date >= key) {
					_available = true;
					_keys.set(KeysTable[key]);
				}
			}

		}

		if (_available) {
			console.log( '%c[PACKETCRYPT] Encrypt sent packets using keys', 'color:#007000', _keys );
		}
	}


	/**
	 * Encrypt header using keys
	 *
	 * @param {DataView} view
	 */
	function Process(view)
	{
		if (_available) {
			var cmd = view.getInt16( 0, true);

			// Update key
			_keys[0] = (imul(_keys[0], _keys[1]) + _keys[2]) & 0xFFFFFFFF;

			// Encrypt header
			cmd ^= (_keys[0] >> 16) & 0x7FFF;

			view.setInt16( 0, cmd, true);
		}
	}


	/**
	 * Export
	 */
	return {
		init:    Init,
		process: Process
	};
});
